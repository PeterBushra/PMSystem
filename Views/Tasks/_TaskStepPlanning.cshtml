@model Jobick.Models.Task
@{
    var otherTasksWeight = (decimal)(ViewData["OtherTasksWeight"] ?? 0m);
    var otherTasksWeightFormatted = (string)(ViewData["OtherTasksWeightFormatted"] ?? otherTasksWeight.ToString("N2"));
    var remainingWeightFormatted = (string)(ViewData["RemainingWeightFormatted"] ?? Math.Max(100m - otherTasksWeight, 0m).ToString("N2"));
    var hasProjectTotal = (bool)(ViewData["HasProjectTotal"] ?? false);
    var remainingBeforeFormatted = (string)(ViewData["RemainingCostBeforeFormatted"] ?? (hasProjectTotal ? "0.00" : "غير محدد"));
}

<div class="form-step d-none" data-step="1">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label asp-for="Weight" class="form-label fw-bold">النسبة المخطط (الوزن)</label>
                <div class="input-group">
                    <input asp-for="Weight" id="weightInput" type="number" step="0.01" class="form-control" min="0" max="100" required />
                    <button type="button" class="btn btn-outline-secondary" id="fillWeightBtn" title="استخدم النسبة المتاحة">استخدام المتاح</button>
                </div>
                <span asp-validation-for="Weight" class="text-danger"></span>
                <small class="form-text text-muted">ادخل وزن المهمة بحد اقصي 100</small>
                <small class="form-text text-muted d-block">
                    إجمالي أوزان المهام الأخرى: <span id="otherWeightSpan">@otherTasksWeightFormatted</span>% — المتاح: <span id="remainingWeightSpan">@remainingWeightFormatted</span>% — المجموع بعد الإدخال: <span id="totalWeightWithCurrent">0.00</span>%
                </small>
                <div class="progress mt-2" style="height:8px;">
                    <div id="weightProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="weightError" class="invalid-feedback d-block"></div>
            </div>

            <div class="mb-3">
                <label asp-for="Cost" class="form-label fw-bold">الصرف المخطط</label>
                <div class="input-group">
                    <input asp-for="Cost" id="costInput" type="number" step="0.01" class="form-control" min="0" required />
                    <button type="button" class="btn btn-outline-secondary" id="fillCostBtn" title="استخدم المبلغ المتاح">استخدام المتاح</button>
                </div>
                <span asp-validation-for="Cost" class="text-danger"></span>
                <small class="form-text text-muted d-block">
                    التكلفة المتبقية قبل هذه المهمة:
                    <span id="remainingBeforeSpan">@remainingBeforeFormatted</span>
                </small>
                <div id="costWarning" class="alert alert-warning d-none mt-2 mb-0 py-2 px-3" style="font-size:0.85rem;"></div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label asp-for="ExpectedStartDate" class="form-label fw-bold">تاريخ البدء </label>
                <input asp-for="ExpectedStartDate" type="date" class="form-control js-date date-rtl" required id="expectedStart" />
                <span asp-validation-for="ExpectedStartDate" class="text-danger"></span>
            </div>
            <div class="mb-1">
                <label asp-for="ExpectedEndDate" class="form-label fw-bold">تاريخ الانتهاء </label>
                <input asp-for="ExpectedEndDate" type="date" class="form-control js-date date-rtl" required id="expectedEnd" />
                <span asp-validation-for="ExpectedEndDate" class="text-danger"></span>
                <small class="text-muted d-block">يجب أن يكون تاريخ الانتهاء بعد تاريخ البدء.</small>
            </div>
            <div class="mb-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="form-check form-check-reverse">
                        <input class="form-check-input" type="checkbox" id="autoDaysChk" checked>
                        <label class="form-check-label" for="autoDaysChk">حساب مدة العمل تلقائياً</label>
                    </div>
                    <small class="text-muted">المدة المحسوبة: <strong><span id="computedDays">0</span></strong> يوم عمل</small>
                </div>
            </div>
            <div class="mb-3">
                <label asp-for="ManyDaysToComplete" class="form-label fw-bold">المدة المطلوبة للانتهاء (ايام عمل)</label>
                <input asp-for="ManyDaysToComplete" type="number" class="form-control" required id="daysToComplete" min="0" />
                <span asp-validation-for="ManyDaysToComplete" class="text-danger"></span>
            </div>
        </div>
    </div>
</div>
